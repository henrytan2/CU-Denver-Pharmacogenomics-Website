{% extends 'base.html' %}
{% block content %}
    <body style="background-image:none;">
    <table id="ExomeTable"
           class="table table-hover table-striped d-none">
        <thead>
        <tr>
            <th>VariantID</th>
            <th>AlleleFrequency</th>
            <th>AlleleNumber</th>
            <th>AlleleCount</th>
            <th>AlleleCountHemi</th>
            <th>AlleleCountHomozygote</th>
            <th>Filters</th>
            <th>AfricanAlleleCount</th>
            <th>AfricanAlleleNumber</th>
            <th>AfricanAlleleFreq</th>
            <th>AmericanAlleleCount</th>
            <th>AmericanAlleleNumber</th>
            <th>AmericanAlleleFreq</th>
            <th>AshkenaziJewishAlleleCount</th>
            <th>AshkenaziJewishAlleleNumber</th>
            <th>AshkenaziJewishAlleleFreq</th>
            <th>EastAsianAlleleCount</th>
            <th>EastAsianAlleleNumber</th>
            <th>EastAsianAlleleFreq</th>
            <th>FinnishAlleleCount</th>
            <th>FinnishAlleleNumber</th>
            <th>FinnishAlleleFreq</th>
            <th>EuropeanAlleleCount</th>
            <th>EuropeanAlleleNumber</th>
            <th>EuropeanAlleleFreq</th>
            <th>OtherAlleleCount</th>
            <th>OtherAlleleNumber</th>
            <th>OtherAlleleFreq</th>
            <th>SouthAsianAlleleCount</th>
            <th>SouthAsianAlleleNumber</th>
            <th>SouthAsianAlleleFreq</th>
            <th>Flags</th>
            <th>Chrom</th>
            <th>Pos</th>
            <th>Alt</th>
            <th>Consequence</th>
            <th>ConsequenceInCanonicalTranscript</th>
            <th>HGVS</th>
            <th>HGVSVc</th>
            <th>HGVSVp</th>
            <th>lof</th>
            <th>lof_filter</th>
            <th>lof_flags</th>
            <th>rsid</th>
        </tr>
        </thead>
    </table>
    </body>

    <script>
        var dtTable;
        var gnomadData;
        var transcript;
        $(document).ready(function () {
            var currentURLString = window.location.href;
            var currentURL = new URL(currentURLString);
            var geneID = currentURL.searchParams.get("gene_id");
            document.title = geneID;
            $.ajax({
                type: "POST",
                data: {"geneID": geneID},
                url: "{% url 'gtexome:exome' %}",
                success: function (response) {
                    gnomadData = response;
                    var exome_data = gnomadData.data["gene"]["variants"];
                    exome_data.forEach(function (item) {
                        if (item["exome"] === null) {
                            item["exome"] = {"populations": null};
                        }
                    });
                    WireUpDataTable(exome_data);
                }
            });
        });

        function WireUpDataTable(data) {
            dtTable = $("#ExomeTable")
                .on("init.dt", function () {
                    $("#ExomeTable").removeClass("d-none");
                })
                .DataTable({
                    dom: "lBfrtip",
                    buttons: [
                        "csv"
                    ],
                    data: data,
                    columns: [
                        {
                            data: "variantId",
                            defaultContent: "",
                        },
                        {
                            data: "exome.af",
                            defaultContent: "",
                        },
                        {
                            data: "exome.an",
                            defaultContent: "",
                        },
                        {
                            data: "exome.ac",
                            defaultContent: "",
                        },
                        {
                            data: "exome.ac_hemi",
                            defaultContent: "",
                        },
                        {
                            data: "exome.ac_hom",
                            defaultContent: "",
                        },
                        {
                            data: "exome.filters",
                            defaultContent: "",
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[0].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[0].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[0].ac / data[0].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[1].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[1].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[1].ac / data[1].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[2].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[2].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[2].ac / data[2].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[3].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[3].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[3].ac / data[3].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[4].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[4].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[4].ac / data[4].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[5].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[5].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[5].ac / data[5].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[6].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[6].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[6].ac / data[6].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: 'exome.populations',
                            render:
                                function(data) {
                                if (data !== null) {
                                    return data[7].ac;
                                }
                            },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[7].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "exome.populations",
                            render:
                                function (data) {
                                    if (data !== null) {
                                        return data[7].ac / data[7].an;
                                    }
                                },
                            defaultContent: 0,
                        },
                        {
                            data: "flags",
                            defaultContent: "",
                        },
                        {
                            data: "chrom",
                            defaultContent: "",
                        },
                        {
                            data: "pos",
                            defaultContent: "",
                        },
                        {
                            data: "alt",
                            defaultContent: "",
                        },
                        {
                            data: "consequence",
                            defaultContent: "",
                        },
                        {
                            data: "consequence_in_canonical_transcript",
                            defaultContent: "",
                        },
                        {
                            data: "hgvs",
                            defaultContent: "",
                        },
                        {
                            data: "hgvsc",
                            defaultContent: "",
                        },
                        {
                            data: "hgvsp",
                            defaultContent: "",
                        },
                        {
                            data: "lof",
                            defaultContent: "",
                        },
                        {
                            data: "lof_filter",
                            defaultContent: "",
                        },
                        {
                            data: "lof_flags",
                            defaultContent: "",
                        },
                        {
                            data: "rsid",
                            defaultContent: "",
                        },
                    ],
                    order: [[1, "desc"]]
                });
        }
    </script>
{% endblock %}