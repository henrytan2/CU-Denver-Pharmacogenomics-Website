{% extends 'base.html' %}
{% block content %}
    <body style="background-image:none;">
    <div id="fda-info"></div>
    <table id="FDATable"
           class="table table-hover table-striped d-none">
        <thead>
        <tr>
            <th>Term</th>
            <th>Count</th>
        </tr>
        </thead>
    </table>
    </body>
    <script>
        var fdaData;
        var dtTable;

        $(document).ready(function () {
            var currentURLString = window.location.href;
            var currentURL = new URL(currentURLString);
            var drugName = currentURL.searchParams.get("drug_name");
            document.title = drugName;
            $.ajax({
                type: "POST",
                data: {"drugName": drugName},
                url: "{% url 'pharmacogenomics:fda' %}",
                success: function (response) {
                    if (response["error"] != null) {
                        $("#fda-info").append("<h1>No info was found on this drug from fda.gov</h1>");
                    } else {
                        fdaData = response;
                        $("#fda-info").append("<p>Last updated: " + fdaData.meta.last_updated + " </p>" +
                            "<h2>FDA Side Effect Data for " +drugName+ "</h2>");
                        WireUpDataTable(fdaData["results"]);
                    }
                },
            });
        });

        function WireUpDataTable(data) {
            dtTable = $("#FDATable")
                .on("init.dt", function () {
                    $("#FDATable").removeClass("d-none");
                })
                .DataTable({
                    dom: "lBfrtip",
                    autoWidth: false,
                    buttons: [{
                        extend: "csv",
                        exportOptions: {
                            columns: ":visible",
                            rows: ":visible",
                        }
                    }],
                    data: data,
                    columns: [
                        {
                            data: "term",
                            defaultContent: "",
                        },
                        {
                            data: "count",
                            defaultContent: 0,
                        }
                    ]
                });
        }
    </script>
{% endblock %}